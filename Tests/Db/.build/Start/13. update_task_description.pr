{
  "Text": "update tasks set description='Hello PLang world'  where id=%id%",
  "ModuleType": null,
  "Reload": false,
  "LlmRequest": [
    {
      "temperature": 0.0,
      "top_p": 0.0,
      "frequencyPenalty": 0.0,
      "presencePenalty": 0.0,
      "maxLength": 4000,
      "llmResponseType": "json",
      "scheme": "{\n\t\"ExplainUserIntent\": string,\n\t\"Name\": string,\n\t\"Parameters\"?: [{\n\t\"Type\": string,\n\t\"Name\": string,\n\t\"Value\"?: object\n}] = null,\n\t\"ReturnValues\"?: [{\n\t\"Type\": string,\n\t\"VariableName\": string\n}] = null,\n\t\"TableNames\"?: string[] = null,\n\t\"DataSource\"?: string = null,\n\t\"AffectedColumns\"? : { String : String, ... } = null\n}",
      "model": "gpt-4o",
      "promptMessage": [
        {
          "role": "system",
          "content": [
            {
              "type": "text",
              "text": "Parse user intent.\r\n\r\nExplainUserIntent: Write short description of what user want to accomplish\r\nFunctionName: Select the correct function from list of available functions based on user intent.\r\nTableNames: Tables defined in sql statement\r\nAffectedColumns: Dictionary of affected columns with type(primary_key|select|insert|update|delete|create|alter|index|drop|where|order|other), e.g. select name from users => 'name':'select'\r\n<dataSource>\r\ndataSourceName:data\r\nDatabase type: Microsoft.Data.Sqlite.SqliteConnection\r\nDatabase name: data\r\n</dataSource>\r\n\r\nRules:\r\n- variable is defined with starting and ending %, e.g. %name%\r\n- ALL %variable% in sql MUST be a ParameterInfo and be set a @variable\r\n- You MUST generate valid sql statement for Microsoft.Data.Sqlite.SqliteConnection\r\n- On CreateTable, include primary key, id, not null,  when not defined by user. \r\n- Number(int => long) MUST be type System.Int64 unless defined by user.\r\n"
            },
            {
              "type": "text",
              "text": "You MUST respond in JSON, scheme:\r\n {\n\t\"ExplainUserIntent\": string,\n\t\"Name\": string,\n\t\"Parameters\"?: [{\n\t\"Type\": string,\n\t\"Name\": string,\n\t\"Value\"?: object\n}] = null,\n\t\"ReturnValues\"?: [{\n\t\"Type\": string,\n\t\"VariableName\": string\n}] = null,\n\t\"TableNames\"?: string[] = null,\n\t\"DataSource\"?: string = null,\n\t\"AffectedColumns\"? : { String : String, ... } = null\n}"
            }
          ]
        },
        {
          "role": "assistant",
          "content": [
            {
              "type": "text",
              "text": "## functions available starts ##\r\n[{\"MethodName\":\"AsyncConstructor\",\"Parameters\":[]},{\"Description\":\"Create a datasource to a database\",\"MethodName\":\"CreateDataSource\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"name\",\"DefaultValue\":\"data\"},{\"Type\":\"System.String\",\"Name\":\"databaseType\",\"DefaultValue\":\"sqlite\"},{\"Type\":\"System.Nullable`1[System.Boolean]\",\"Name\":\"setAsDefaultForApp\"},{\"Type\":\"System.Nullable`1[System.Boolean]\",\"Name\":\"keepHistoryEventSourcing\"}],\"ReturnValue\":{\"Type\":\"PLang.Modules.DbModule.ModuleSettings+DataSource\"}},{\"Description\":\"gets all databases that have been created\",\"MethodName\":\"GetDataSources\",\"Parameters\":[],\"ReturnValue\":{\"Type\":\"PLang.Modules.DbModule.ModuleSettings+DataSource\"}},{\"Description\":\"gets the current datasource\",\"MethodName\":\"GetDataSource\",\"Parameters\":[],\"ReturnValue\":{\"Type\":\"PLang.Modules.DbModule.ModuleSettings+DataSource\"}},{\"MethodName\":\"SetDataSourceName\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"name\"}],\"ReturnValue\":{\"Type\":\"PLang.Modules.DbModule.ModuleSettings+DataSource\"}},{\"MethodName\":\"BeginTransaction\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"name\"}]},{\"MethodName\":\"EndTransaction\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"name\"}]},{\"MethodName\":\"Rollback\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"name\"},{\"Type\":\"System.Boolean\",\"Name\":\"rollbackAllTranscations\",\"DefaultValue\":true}]},{\"MethodName\":\"LoadExtension\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"fileName\"},{\"Type\":\"System.String\",\"Name\":\"procName\"}]},{\"Description\":\"Return list of tables and views in a datasource\",\"MethodName\":\"GetDbScheme\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"dataSourceName\"}],\"ReturnValue\":{\"Type\":\"List<String>\"}},{\"Description\":\"Returns tables and views in database with the columns description\",\"MethodName\":\"GetDatabaseStructure\",\"Parameters\":[{\"Type\":\"List<string>\",\"Name\":\"tables\"},{\"Type\":\"System.String\",\"Name\":\"dataSourceName\"}],\"ReturnValue\":{\"Type\":\"Dictionary<String,Object>\"}},{\"MethodName\":\"InsertEventSourceData\",\"Parameters\":[{\"Type\":\"System.Int64\",\"Name\":\"id\"},{\"Type\":\"System.String\",\"Name\":\"data\"},{\"Type\":\"System.String\",\"Name\":\"keyHash\"}],\"ReturnValue\":{\"Type\":\"System.Int32\"}},{\"Description\":\"Executes a sql statement that is fully dynamic or from a variable.\",\"MethodName\":\"ExecuteDynamicSql\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"sql\"},{\"Type\":\"System.String\",\"Name\":\"dataSourceName\"}],\"ReturnValue\":{\"Type\":\"System.Int64\"}},{\"Description\":\"Executes a sql statement that defined by user. This statement will be validated.\",\"MethodName\":\"Execute\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"sql\"},{\"Type\":\"System.String\",\"Name\":\"dataSourceName\"}],\"ReturnValue\":{\"Type\":\"System.Int64\"}},{\"Description\":\"When user does not define a primary key, add it to the create statement as id column not null, when KeepHistory is set to false, make the column auto increment\",\"MethodName\":\"CreateTable\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"sql\"}],\"ReturnValue\":{\"Type\":\"System.Int64\"}},{\"Description\":\"When select should return 1 row (limit 1)\",\"MethodName\":\"SelectOneRow\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"sql\"},{\"Type\":\"System.Collections.Generic.List`1[PLang.Modules.DbModule.Program+ParameterInfo]\",\"Name\":\"SqlParameters\",\"TypeProperties\":[{\"Type\":\"System.String\",\"Name\":\"ParameterName\"},{\"Type\":\"System.Object\",\"Name\":\"VariableNameOrValue\"},{\"Type\":\"System.String\",\"Name\":\"TypeFullName\"}]},{\"Type\":\"System.String\",\"Name\":\"dataSourceName\"}],\"ReturnValue\":{\"Type\":\"System.Object\"}},{\"MethodName\":\"Select\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"sql\"},{\"Type\":\"System.Collections.Generic.List`1[PLang.Modules.DbModule.Program+ParameterInfo]\",\"Name\":\"SqlParameters\",\"TypeProperties\":[{\"Type\":\"System.String\",\"Name\":\"ParameterName\"},{\"Type\":\"System.Object\",\"Name\":\"VariableNameOrValue\"},{\"Type\":\"System.String\",\"Name\":\"TypeFullName\"}]},{\"Type\":\"System.String\",\"Name\":\"dataSourceName\"}],\"ReturnValue\":{\"Type\":\"List<Object>\"}},{\"MethodName\":\"Update\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"sql\"},{\"Type\":\"System.Collections.Generic.List`1[PLang.Modules.DbModule.Program+ParameterInfo]\",\"Name\":\"SqlParameters\",\"TypeProperties\":[{\"Type\":\"System.String\",\"Name\":\"ParameterName\"},{\"Type\":\"System.Object\",\"Name\":\"VariableNameOrValue\"},{\"Type\":\"System.String\",\"Name\":\"TypeFullName\"}]},{\"Type\":\"System.String\",\"Name\":\"dataSourceName\"}],\"ReturnValue\":{\"Type\":\"System.Int64\"}},{\"MethodName\":\"Delete\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"sql\"},{\"Type\":\"System.Collections.Generic.List`1[PLang.Modules.DbModule.Program+ParameterInfo]\",\"Name\":\"SqlParameters\",\"TypeProperties\":[{\"Type\":\"System.String\",\"Name\":\"ParameterName\"},{\"Type\":\"System.Object\",\"Name\":\"VariableNameOrValue\"},{\"Type\":\"System.String\",\"Name\":\"TypeFullName\"}]},{\"Type\":\"System.String\",\"Name\":\"dataSourceName\"}],\"ReturnValue\":{\"Type\":\"System.Int64\"}},{\"Description\":\"Insert or update table(Upsert). Will return affected row count\",\"MethodName\":\"InsertOrUpdate\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"sql\"},{\"Type\":\"System.Collections.Generic.List`1[PLang.Modules.DbModule.Program+ParameterInfo]\",\"Name\":\"SqlParameters\",\"TypeProperties\":[{\"Type\":\"System.String\",\"Name\":\"ParameterName\"},{\"Type\":\"System.Object\",\"Name\":\"VariableNameOrValue\"},{\"Type\":\"System.String\",\"Name\":\"TypeFullName\"}]},{\"Type\":\"System.String\",\"Name\":\"dataSourceName\"}],\"ReturnValue\":{\"Type\":\"System.Int64\"}},{\"Description\":\"Insert or update table(Upsert). Will return the primary key of the affected row\",\"MethodName\":\"InsertOrUpdateAndSelectIdOfRow\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"sql\"},{\"Type\":\"System.Collections.Generic.List`1[PLang.Modules.DbModule.Program+ParameterInfo]\",\"Name\":\"SqlParameters\",\"TypeProperties\":[{\"Type\":\"System.String\",\"Name\":\"ParameterName\"},{\"Type\":\"System.Object\",\"Name\":\"VariableNameOrValue\"},{\"Type\":\"System.String\",\"Name\":\"TypeFullName\"}]},{\"Type\":\"System.String\",\"Name\":\"dataSourceName\"}],\"ReturnValue\":{\"Type\":\"System.Object\"}},{\"Description\":\"Insert into table. Will return affected row count\",\"MethodName\":\"Insert\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"sql\"},{\"Type\":\"System.Collections.Generic.List`1[PLang.Modules.DbModule.Program+ParameterInfo]\",\"Name\":\"SqlParameters\",\"TypeProperties\":[{\"Type\":\"System.String\",\"Name\":\"ParameterName\"},{\"Type\":\"System.Object\",\"Name\":\"VariableNameOrValue\"},{\"Type\":\"System.String\",\"Name\":\"TypeFullName\"}]},{\"Type\":\"System.String\",\"Name\":\"dataSourceName\"}],\"ReturnValue\":{\"Type\":\"System.Int64\"}},{\"Description\":\"Insert statement that will return the id of the inserted row. Use only if user requests the id\",\"MethodName\":\"InsertAndSelectIdOfInsertedRow\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"sql\"},{\"Type\":\"System.Collections.Generic.List`1[PLang.Modules.DbModule.Program+ParameterInfo]\",\"Name\":\"SqlParameters\",\"TypeProperties\":[{\"Type\":\"System.String\",\"Name\":\"ParameterName\"},{\"Type\":\"System.Object\",\"Name\":\"VariableNameOrValue\"},{\"Type\":\"System.String\",\"Name\":\"TypeFullName\"}]},{\"Type\":\"System.String\",\"Name\":\"dataSourceName\"}],\"ReturnValue\":{\"Type\":\"System.Object\"}},{\"Description\":\"ONLY When inserting list of items(%variables% is plural). Insert a list(bulk) into database, return number of rows inserted. columnMapping maps which variable should match with a column. User will define that he is using bulk insert.\",\"MethodName\":\"InsertBulk\",\"Parameters\":[{\"Type\":\"System.String\",\"Name\":\"tableName\"},{\"Type\":\"System.Collections.Generic.List`1[System.Object]\",\"Name\":\"itemsToInsert\"},{\"Type\":\"Dictionary<String, Object>\",\"Name\":\"columnMapping\",\"TypeProperties\":[{\"Type\":\"System.Object\",\"Name\":\"Item\"}]},{\"Type\":\"System.Boolean\",\"Name\":\"ignoreContraintOnInsert\",\"DefaultValue\":false}],\"ReturnValue\":{\"Type\":\"System.Int64\"}},{\"MethodName\":\"GetAdditionalSystemErrorInfo\",\"Parameters\":[],\"ReturnValue\":{\"Type\":\"System.String\"}},{\"MethodName\":\"GetAdditionalAssistantErrorInfo\",\"Parameters\":[],\"ReturnValue\":{\"Type\":\"System.String\"}}]\r\n## functions available ends ##\r\n## defined variables ##\r\nid (type:object), \r\n## defined variables ##"
            }
          ]
        },
        {
          "role": "user",
          "content": [
            {
              "type": "text",
              "text": "update tasks set description='Hello PLang world'  where id=%id%"
            }
          ]
        }
      ],
      "type": "PLang.Modules.DbModule.Builder",
      "caching": true,
      "RawResponse": "```json\n{\n\t\"ExplainUserIntent\": \"The user wants to update the description of a task in the tasks table where the id matches the provided value.\",\n\t\"Name\": \"Update\",\n\t\"Parameters\": [{\n\t\t\"Type\": \"System.String\",\n\t\t\"Name\": \"sql\",\n\t\t\"Value\": \"UPDATE tasks SET description = @description WHERE id = @id\"\n\t}, {\n\t\t\"Type\": \"System.Collections.Generic.List`1[PLang.Modules.DbModule.Program+ParameterInfo]\",\n\t\t\"Name\": \"SqlParameters\",\n\t\t\"Value\": [{\n\t\t\t\"ParameterName\": \"description\",\n\t\t\t\"VariableNameOrValue\": \"Hello PLang world\",\n\t\t\t\"TypeFullName\": \"System.String\"\n\t\t}, {\n\t\t\t\"ParameterName\": \"id\",\n\t\t\t\"VariableNameOrValue\": \"id\",\n\t\t\t\"TypeFullName\": \"System.Object\"\n\t\t}]\n\t}, {\n\t\t\"Type\": \"System.String\",\n\t\t\"Name\": \"dataSourceName\",\n\t\t\"Value\": \"data\"\n\t}],\n\t\"TableNames\": [\"tasks\"],\n\t\"DataSource\": \"data\",\n\t\"AffectedColumns\": {\n\t\t\"description\": \"update\",\n\t\t\"id\": \"where\"\n\t}\n}\n```"
    }
  ],
  "Properties": {
    "Parameters": {
      "sql": [
        {
          "Name": "sql",
          "FullTypeName": "System.String"
        }
      ],
      "SqlParameters": [
        {
          "Name": "SqlParameters",
          "FullTypeName": "System.Object"
        }
      ],
      "dataSourceName": [
        {
          "Name": "dataSourceName",
          "FullTypeName": "System.String"
        }
      ]
    },
    "ReturnValues": {}
  },
  "GenericFunctionType": "PLang.Modules.DbModule.Builder+DbGenericFunction",
  "Function": {
    "ExplainUserIntent": "The user wants to update the description of a task in the tasks table where the id matches the provided value.",
    "Name": "Update",
    "Parameters": [
      {
        "Type": "System.String",
        "Name": "sql",
        "Value": "UPDATE tasks SET description = @description WHERE id = @id"
      },
      {
        "Type": "System.Collections.Generic.List`1[PLang.Modules.DbModule.Program+ParameterInfo]",
        "Name": "SqlParameters",
        "Value": [
          {
            "ParameterName": "description",
            "VariableNameOrValue": "Hello PLang world",
            "TypeFullName": "System.String"
          },
          {
            "ParameterName": "id",
            "VariableNameOrValue": "id",
            "TypeFullName": "System.Object"
          }
        ]
      },
      {
        "Type": "System.String",
        "Name": "dataSourceName",
        "Value": "data"
      }
    ],
    "ReturnValues": null,
    "TableNames": [
      "tasks"
    ],
    "DataSource": "data",
    "AffectedColumns": {
      "description": "update",
      "id": "where"
    }
  }
}