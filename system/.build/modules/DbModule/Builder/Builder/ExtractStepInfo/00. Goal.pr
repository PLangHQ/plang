{
  "GoalName": "ExtractStepInfo",
  "Comment": null,
  "Version": 1,
  "GoalSteps": [
    {
      "Text": "get all datasources, write to %dataSources%",
      "Comment": "First LLM call - extract datasources and tables from step (lightweight, no schema needed)",
      "ModuleType": "PLang.Modules.DbModule",
      "Name": "get_all_datasources",
      "Description": "Execute a command or query to retrieve all data sources available in the system or environment and write the resulting list or collection into the variable %dataSources% for further use.",
      "PrFileName": "01. get_all_datasources.pr",
      "RelativePrPath": ".build\\modules\\DbModule\\Builder\\Builder\\ExtractStepInfo\\01. get_all_datasources.pr",
      "InstructionHash": null,
      "Indent": 0,
      "Execute": true,
      "RunOnce": false,
      "Confidence": null,
      "Inconsistency": null,
      "Generated": "2025-12-15T11:25:39.9263125+00:00",
      "WaitForExecution": true,
      "LoggerLevel": null,
      "ErrorHandlers": null,
      "Retry": false,
      "RetryCount": 1,
      "CacheHandler": null,
      "CancellationHandler": null,
      "Number": 0,
      "LineNumber": 12,
      "EventBinding": null,
      "IsEvent": false,
      "Hash": "60f424d8e7716a61e3ed4067389df7d573d4a8912fcade261251fd81241ee427",
      "BuilderVersion": null,
      "RelativeGoalPath": "\\modules\\DbModule\\Builder\\Builder.goal",
      "UserIntent": null
    },
    {
      "Text": "if %dataSources.count% == 0 and %goal.IsSetup% is false then",
      "Comment": null,
      "ModuleType": "PLang.Modules.ConditionalModule",
      "Name": "check_datasources_count_and_goal_setup_condition",
      "Description": "Evaluate whether the variable %dataSources.count% equals zero and the variable %goal.IsSetup% is false, and based on this combined condition, proceed with the corresponding conditional logic",
      "PrFileName": "02. check_datasources_count_and_goal_setup_condition.pr",
      "RelativePrPath": ".build\\modules\\DbModule\\Builder\\Builder\\ExtractStepInfo\\02. check_datasources_count_and_goal_setup_condition.pr",
      "InstructionHash": null,
      "Indent": 0,
      "Execute": true,
      "RunOnce": false,
      "Confidence": null,
      "Inconsistency": null,
      "Generated": "2025-12-16T10:07:05.0453854+00:00",
      "WaitForExecution": true,
      "LoggerLevel": null,
      "ErrorHandlers": null,
      "Retry": false,
      "RetryCount": 1,
      "CacheHandler": null,
      "CancellationHandler": null,
      "Number": 1,
      "LineNumber": 13,
      "EventBinding": null,
      "IsEvent": false,
      "Hash": "47642455a46e6a8cd8180cdb9e74d09cd42e4641fcbfe05471a007731911f415",
      "BuilderVersion": null,
      "RelativeGoalPath": "\\modules\\DbModule\\Builder\\Builder.goal",
      "UserIntent": null
    },
    {
      "Text": "throw error \"You must define data source first. Create Setup.goal file with create table statement or create data source.\", key: \"DataSourceMissing\"",
      "Comment": null,
      "ModuleType": "PLang.Modules.ThrowErrorModule",
      "Name": "throw_datasource_missing_error",
      "Description": "Throw an error with the message 'You must define data source first. Create Setup.goal file with create table statement or create data source.' and assign the error key 'DataSourceMissing' to indicate the missing data source condition.",
      "PrFileName": "03. throw_datasource_missing_error.pr",
      "RelativePrPath": ".build\\modules\\DbModule\\Builder\\Builder\\ExtractStepInfo\\03. throw_datasource_missing_error.pr",
      "InstructionHash": null,
      "Indent": 4,
      "Execute": false,
      "RunOnce": false,
      "Confidence": null,
      "Inconsistency": null,
      "Generated": "2025-12-16T10:07:13.3352201+00:00",
      "WaitForExecution": true,
      "LoggerLevel": null,
      "ErrorHandlers": null,
      "Retry": false,
      "RetryCount": 1,
      "CacheHandler": null,
      "CancellationHandler": null,
      "Number": 2,
      "LineNumber": 14,
      "EventBinding": null,
      "IsEvent": false,
      "Hash": "754a6468ee2f68287160ed9839276f9723f9f3c22e3d8ae8031a5c6930152a2b",
      "BuilderVersion": null,
      "RelativeGoalPath": "\\modules\\DbModule\\Builder\\Builder.goal",
      "UserIntent": null
    },
    {
      "Text": "get current datasource, write to %currentDataSource%",
      "Comment": null,
      "ModuleType": "PLang.Modules.DbModule",
      "Name": "get_current_datasource",
      "Description": "Fetch the current database datasource configuration or connection information and write the result into the variable %currentDataSource% for further use in the program.",
      "PrFileName": "04. get_current_datasource.pr",
      "RelativePrPath": ".build\\modules\\DbModule\\Builder\\Builder\\ExtractStepInfo\\04. get_current_datasource.pr",
      "InstructionHash": null,
      "Indent": 0,
      "Execute": true,
      "RunOnce": false,
      "Confidence": "High",
      "Inconsistency": null,
      "Generated": "2025-12-16T10:14:15.1631663+00:00",
      "WaitForExecution": true,
      "LoggerLevel": null,
      "ErrorHandlers": null,
      "Retry": false,
      "RetryCount": 1,
      "CacheHandler": null,
      "CancellationHandler": null,
      "Number": 3,
      "LineNumber": 15,
      "EventBinding": null,
      "IsEvent": false,
      "Hash": "3efaaf48df3ce443765a99e2067942bfda5ae22c8cdaa55e416a4aaafea0ef7e",
      "BuilderVersion": null,
      "RelativeGoalPath": "\\modules\\DbModule\\Builder\\Builder.goal",
      "UserIntent": "Retrieve the current database datasource and store it in a variable"
    },
    {
      "Text": "render template llm/extractStepInfo.llm, write to %extractPrompt%",
      "Comment": null,
      "ModuleType": "PLang.Modules.TemplateEngineModule",
      "Name": "render_template_to_variable",
      "Description": "Render the template file located at llm/extractStepInfo.llm using the template engine and write the rendered output into the variable %extractPrompt% for further use",
      "PrFileName": "05. render_template_to_variable.pr",
      "RelativePrPath": ".build\\modules\\DbModule\\Builder\\Builder\\ExtractStepInfo\\05. render_template_to_variable.pr",
      "InstructionHash": null,
      "Indent": 0,
      "Execute": true,
      "RunOnce": false,
      "Confidence": "Very High",
      "Inconsistency": null,
      "Generated": "2025-12-16T10:14:19.0740207+00:00",
      "WaitForExecution": true,
      "LoggerLevel": null,
      "ErrorHandlers": null,
      "Retry": false,
      "RetryCount": 1,
      "CacheHandler": null,
      "CancellationHandler": null,
      "Number": 4,
      "LineNumber": 16,
      "EventBinding": null,
      "IsEvent": false,
      "Hash": "c3ae2e31bb0a13b1bc5afb4c53e96c2875bfaf7ed2319503d19940d6d261669c",
      "BuilderVersion": null,
      "RelativeGoalPath": "\\modules\\DbModule\\Builder\\Builder.goal",
      "UserIntent": "Render a template file and store the rendered content into a variable"
    },
    {
      "Text": "[llm] system: %extractPrompt%\n    user: %step.Text%\n    scheme: {\n        \"dataSourceNames\": string[],\n        \"isCreateDataSource\": \"bool\",\n        \"tables\": [{name, datasource:string|null}]\n    }\n    write to %stepInfo%",
      "Comment": null,
      "ModuleType": "PLang.Modules.LlmModule",
      "Name": "extract_datasource_and_table_info_with_llm",
      "Description": "Send a prompt to the language model with system instructions from %extractPrompt% and user input from %step.Text%, requesting a JSON response describing data source names, a flag indicating if a data source should be created, and a list of tables with their names and associated data sources. The response is stored in %stepInfo%.",
      "PrFileName": "06. extract_datasource_and_table_info_with_llm.pr",
      "RelativePrPath": ".build\\modules\\DbModule\\Builder\\Builder\\ExtractStepInfo\\06. extract_datasource_and_table_info_with_llm.pr",
      "InstructionHash": null,
      "Indent": 0,
      "Execute": true,
      "RunOnce": false,
      "Confidence": "Very High",
      "Inconsistency": null,
      "Generated": "2025-12-16T10:14:29.5585256+00:00",
      "WaitForExecution": true,
      "LoggerLevel": null,
      "ErrorHandlers": null,
      "Retry": false,
      "RetryCount": 1,
      "CacheHandler": null,
      "CancellationHandler": null,
      "Number": 5,
      "LineNumber": 17,
      "EventBinding": null,
      "IsEvent": false,
      "Hash": "609e76293a47c6deceddc795c8c720a933eae2feb205c076ea5857469b239078",
      "BuilderVersion": null,
      "RelativeGoalPath": "\\modules\\DbModule\\Builder\\Builder.goal",
      "UserIntent": "Use a language model to process input text and extract structured information about data sources and tables"
    },
    {
      "Text": "append %stepInfo!llm% to %step.llm%",
      "Comment": null,
      "ModuleType": "PLang.Modules.VariableModule",
      "Name": "append_stepinfo_llm_to_step_llm",
      "Description": "Take the value stored in the variable %stepInfo!llm% and append it to the existing value of the variable %step.llm%, effectively concatenating the two variable values.",
      "PrFileName": "07. append_stepinfo_llm_to_step_llm.pr",
      "RelativePrPath": ".build\\modules\\DbModule\\Builder\\Builder\\ExtractStepInfo\\07. append_stepinfo_llm_to_step_llm.pr",
      "InstructionHash": null,
      "Indent": 0,
      "Execute": true,
      "RunOnce": false,
      "Confidence": "Very High",
      "Inconsistency": null,
      "Generated": "2025-12-16T10:14:29.6392669+00:00",
      "WaitForExecution": true,
      "LoggerLevel": null,
      "ErrorHandlers": null,
      "Retry": false,
      "RetryCount": 1,
      "CacheHandler": null,
      "CancellationHandler": null,
      "Number": 6,
      "LineNumber": 25,
      "EventBinding": null,
      "IsEvent": false,
      "Hash": "04f2969c8439925ec5d6dd9409c7624ff66881391218635bfb5c9dc38417d20b",
      "BuilderVersion": null,
      "RelativeGoalPath": "\\modules\\DbModule\\Builder\\Builder.goal",
      "UserIntent": "Append the content of the variable %stepInfo!llm% to the variable %step.llm%"
    },
    {
      "Text": "if %stepInfo.dataSourceNames% is empty then",
      "Comment": null,
      "ModuleType": "PLang.Modules.ConditionalModule",
      "Name": "check_if_datasource_names_is_empty",
      "Description": "Evaluate the variable %stepInfo.dataSourceNames% to determine if it contains any data or if it is empty, and then proceed based on that condition",
      "PrFileName": "08. check_if_datasource_names_is_empty.pr",
      "RelativePrPath": ".build\\modules\\DbModule\\Builder\\Builder\\ExtractStepInfo\\08. check_if_datasource_names_is_empty.pr",
      "InstructionHash": null,
      "Indent": 0,
      "Execute": true,
      "RunOnce": false,
      "Confidence": "Very High",
      "Inconsistency": null,
      "Generated": "2025-12-16T10:14:29.7464735+00:00",
      "WaitForExecution": true,
      "LoggerLevel": null,
      "ErrorHandlers": null,
      "Retry": false,
      "RetryCount": 1,
      "CacheHandler": null,
      "CancellationHandler": null,
      "Number": 7,
      "LineNumber": 26,
      "EventBinding": null,
      "IsEvent": false,
      "Hash": "a77edb510e660da9fe43c90f74b5abeb0bfb7f48559bbe8f9f78735ac3d08f5b",
      "BuilderVersion": null,
      "RelativeGoalPath": "\\modules\\DbModule\\Builder\\Builder.goal",
      "UserIntent": "Check if the variable %stepInfo.dataSourceNames% is empty or not"
    },
    {
      "Text": "[db] get current datasource, write into %stepInfo.dataSourceNames%",
      "Comment": null,
      "ModuleType": "PLang.Modules.DbModule",
      "Name": "get_current_datasource",
      "Description": "Execute a command to obtain the current active datasource used by the database connection and write this information into the variable %stepInfo.dataSourceNames% for further use.",
      "PrFileName": "09. get_current_datasource.pr",
      "RelativePrPath": ".build\\modules\\DbModule\\Builder\\Builder\\ExtractStepInfo\\09. get_current_datasource.pr",
      "InstructionHash": null,
      "Indent": 4,
      "Execute": false,
      "RunOnce": false,
      "Confidence": "Very High",
      "Inconsistency": null,
      "Generated": "2025-12-16T10:14:32.6379896+00:00",
      "WaitForExecution": true,
      "LoggerLevel": null,
      "ErrorHandlers": null,
      "Retry": false,
      "RetryCount": 1,
      "CacheHandler": null,
      "CancellationHandler": null,
      "Number": 8,
      "LineNumber": 27,
      "EventBinding": null,
      "IsEvent": false,
      "Hash": "638dac7bafbe1e378a4b370f47c38df29372546c7fc5b8f61cda49d1c8114e20",
      "BuilderVersion": null,
      "RelativeGoalPath": "\\modules\\DbModule\\Builder\\Builder.goal",
      "UserIntent": "Retrieve the name or identifier of the current database datasource and store it in the variable %stepInfo.dataSourceNames%"
    }
  ],
  "SubGoals": [],
  "Description": "The ExtractStepInfo goal is designed to extract data sources and tables from a given step. It first retrieves all data sources and checks if any are defined. If no data sources are found and the goal is not set up, it throws an error indicating that a data source must be defined. It then retrieves the current data source, renders a template for extraction, and processes the step's text to gather information about data sources and tables. Finally, it appends the extracted information to the step's llm property and ensures that the data source names are populated appropriately.",
  "Visibility": 0,
  "GoalFileName": "Builder.goal",
  "PrFileName": "00. Goal.pr",
  "PrPath": ".build\\modules\\DbModule\\Builder\\Builder\\ExtractStepInfo\\00. Goal.pr",
  "RelativeGoalPath": "\\modules\\DbModule\\Builder\\Builder.goal",
  "RelativeGoalFolderPath": "\\modules\\DbModule\\Builder",
  "RelativePrPath": ".build\\modules\\DbModule\\Builder\\Builder\\ExtractStepInfo\\00. Goal.pr",
  "RelativePrFolderPath": ".build\\modules\\DbModule\\Builder\\Builder\\ExtractStepInfo",
  "RelativeAppStartupFolderPath": null,
  "BuilderVersion": "1.0.0.0",
  "GoalInfo": null,
  "Injections": [],
  "Signature": null,
  "Hash": "90c2b43b4c47be783c84cbde5e80df5dec36b3e447c6a1648fa3e7ccd746df89",
  "IncomingVariablesRequired": {
    "%goal.IsSetup%": "A boolean indicating whether the goal is set up or not.",
    "%step.Text%": "The text of the step from which data sources and tables will be extracted."
  },
  "DataSourceName": null,
  "IsSetup": false,
  "IsEvent": false,
  "IsStart": false
}